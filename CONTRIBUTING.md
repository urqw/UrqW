# Как внести свой вклад в проект

## Подготовка рабочего пространства

1. Создайте форк репозитория.
2. Клонируйте свой форк: \
	`git clone %url_repo%` \
	или с подмодулями, если собираетесь работать с играми в каталоге и собирать проект для развёртывания в производственных средах, \
	`git clone --recurse-submodules %url_repo%`
3. Установите зависимости проекта: \
	`npm install`
4. Собирите проект (если нужно): \
	`npm run build`

## Процесс внесения изменений

1. Создайте новую ветку (branch).
2. Внесите изменения с учётом следующего:
	* Задокументируйте изменения в файле [CHANGELOG.md](CHANGELOG.md) в разделе версии со статусом "в разработке". Если изменения являются мелкими техническими правками или уже соответствуют одному из пунктов списка, то их можно не документировать. Если они сильно похожи на один из пунктов, то можно переписать этот пункт с обобщающей формулировкой изменений.
	* Если изменения затрагивают функциональность, которая уже документирована в прошлой реализации или является значимым изменением и должна быть документирована, то внесите соответствующие правки или дополнения в файлы [README.md](README.md) и/или [docs/urql.html](docs/urql.html).
3. Сделайте фиксацию изменений (commit).
4. Создайте запрос на вытягивание (pull request)

## Добавление или обновление игры

Рекомендованным способом добавления игр в каталог и последующего их сопровождения является подключение их репозиториев как подмодулей Git в основном репозитории UrqW.

Выполняйте операцию как любое другое внесение изменений (см. "Процесс внесения изменений").

Добавление новой игры:

1. Подготовьте внешний репозиторий с игрой в соответствии со следующими требованиями:
	* Репозиторий игры должен содержать файл manifest.json для UrqW в корректном формате, расположенный либо в корневой директории, либо в директории максимум с одним уровнем вложенности.
	* Репозиторий игры должен содержать минимум 1 файл .qst с кодом игры.
	* Репозиторий игры может содержать другие файлы, необходимые для пакета игры.
	* Крайне желательно, чтобы репозиторий игры не содержал файлов, в названии которых есть не ASCII-символы.
2. Добавьте внешний репозиторий с игрой как подмодуль Git в директорию games основного репозитория UrqW: \
	`git submodule add %url_game_repo% games/%game_name%` \
	Название директории игры (%game_name%) следует оформлять в стиле snake_case: ASCII-символы в нижнем регистре, если надо, разделённые символом подчёркивания.
3. Добавьте информацию о новой игре в файл games.json в основном репозитории UrqW.
4. Проверьте валидность отредактированного файла games.json, выполнив команду: \
	`npm run valid-json`
5. Завершите внесение изменений в основной репозиторий UrqW в соответствии с общим процессом (см. "Процесс внесения изменений").

Обновление уже добавленной игры:

1. Обновите подключённый подмодуль игры: \
	`git submodule update --remote games/%game_name%` \
	или \
	`git submodule update --recursive --remote games/%game_name%` \
	если репозиторий игры сам содержит подмодули.
2. Завершите внесение изменений в основной репозиторий UrqW в соответствии с общим процессом (см. "Процесс внесения изменений").

## Добавление или обновление перевода

UrqW поддерживает интернационализацию пользовательского интерфейса. Можно либо добавить новый перевод, либо обновить существующий.

Выполняйте операцию как любое другое внесение изменений (см. "Процесс внесения изменений").

Все файлы необходимо открывать и сохранять в кодировке UTF-8 без BOM.

Добавление нового перевода:

1. Определите код целевого языка по стандарту ISO 639. Например, код русского языка - "ru". Подробнее см. [Declaring language in HTML, Choosing language values)](https://www.w3.org/International/questions/qa-html-language-declarations.en#langvalues).
2. В директории /locale создайте копию файла en.js и переименуйте его в соответствии с кодом целевого языка, например, ru.js для русского. Вместо en.js можно использовать другой существующий перевод, но есть риск скопировать неполный перевод или чужие ошибки перевода, тогда как en.js является основным файлом перевода. Впрочем, по историческим причинам русский перевод (ru.js) сопровождается разработчиками UrqW и также является полным.
3. Откройте файл нового перевода и отредактируйте его содержимое:
	* Переименуйте объект со строками перевода в соответствии с кодом целевого языка, например, `var ru` для русского.
	* Переведите все значения ключей на целевой язык.
4. Откройте файл index.html и подключите файл нового перевода в контейнере `<head>` рядом с остальными переводами.
5. Откройте файл /js/i18n.js и отредактируйте его содержимое:
	* Добавьте информацию о новом переводе в виде объекта в объект availableLangs, например, для русского:
	```javascript
	    ru: {
	        name: "Russian (русский)",
	        translation: ru
	    }
	```
	* В качестве названия объекта целевого языка и значения ключа translation используйте код целевого языка.
	* В качестве значения ключа name желательно указывать написание названия целевого языка на английском, а потом в скобках на самом целевом языке.
6. Завершите внесение изменений в основной репозиторий UrqW в соответствии с общим процессом (см. "Процесс внесения изменений").

Обновление уже существующего перевода:

1. В директории /locale откройте файл с переводом на целевой язык, например, ru.js для русского.
2. Откройте файл /locale/en.js с основным английским переводом. Вместо en.js можно использовать другой существующий перевод, но есть риск скопировать неполный перевод или чужие ошибки перевода, тогда как en.js является основным файлом перевода. Впрочем, по историческим причинам русский перевод (ru.js) сопровождается разработчиками UrqW и также является полным.
3. Сравните содержимое этих файлов и приведите содержимое файла с переводом на целевой язык в соответствие содержимому файла основного перевода.
4. Завершите внесение изменений в основной репозиторий UrqW в соответствии с общим процессом (см. "Процесс внесения изменений").

## Подготовка новой версии

1. Актуализируйте и синхронизируйте версию UrqW в следующих файлах проекта:
	* В переменной urqw_version в файле [index.html](index.html)
	* В параметре version в файле [package.json](package.json)
	* В файле [package-lock.json](package-lock.json), автоматически обновив его после редактирования [package.json](package.json) командой `npm install`
2. Отредактируйте файл [CHANGELOG.md](CHANGELOG.md):
	* Если это начало разработки новой версии, то в журнале изменений должна должен быть создан новый раздел с номером подготавливаемой версии и указанием статуса "В разработке", например, "Версия 1.0 (в разработке)".
	* Если это подготовка релиза, то в журнале изменений должен быть раздел с номером выпускаемой версии и указанием даты выпуска вместо статуса "в разработке", например, "Версия 1.0 от 20.01.2017".
3. Выполните прочие необходимые действия.
