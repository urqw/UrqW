<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>URQ Language Documentation</title>
    <link href="../vendor/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!--

style.css

html btn
токены

        :use_предмет
        :use_предмет_
        hide_use_

-->

<style>
    .container {
        margin-top: 20px;
        margin-bottom: 100px;
    }

    p {
        margin-left: 40px;
        text-indent: -20px;
        max-width: 800px;
    }

    code, samp {
        display: block;
        margin: 5px 0 20px 40px;
        max-width: 800px;
    }

    samp {
        background-color: #DFF0D8;
        padding: 2px 4px;
        font-size: 90%;
        border-radius: 4px;
    }

    ul, ol {
        margin-left: 40px;
    }

    a {
        cursor: pointer;
    }

    div.example {
        background-color: #E4E4E4;
        max-width: 800px;
        padding: 5px 0;
        margin-left: 30px;
        margin-bottom: 20px;
    }


    div.example h4 {
        margin-left: 20px;
    }
</style>
<div class="container">
    <h2 class="text-center">Описание языка urql</h2>
    <div>
        <h3>Содержание</h3>
        <p><a href="#пояснение к доке">Пояснения к доке</a></p>
        <p><a href="#что такое urq квест">Что такое urq квест?</a></p>
        <p><a href="#системные конструкции">Системные конструкции</a></p>
        <p><a href="#системные переменные">Системные переменные</a></p>
        <p><a href="#операторы">Операторы</a></p>
        <p><a href="#предметы">Предметы</a></p>
        <p><a href="#комментарии">Комментарии</a></p>
        <p><a href="#математические и логические операторы">Математические и логические операторы</a></p>
        <p><a href="#примеры">Примеры</a></p>
        <p><a href="#режимы urq_mode">Режимы urq_mode</a></p>
        <p><a href="#плагины">Плагины</a></p>
    </div>

    <div id="пояснение к доке">
        <h3>Пояснения к доке</h3>
        <p>скобки [] - обязательный параметр</p>
        <p>скобки {} -  необязательный параметр</p>
        <p>В документацию не включены конструкции-рудименты из старых версий интерпретаторов, которые будут работать но
            уже не актуальны или которые лучше не использовать.</p>
    </div>

    <div id="что такое urq квест">
        <h3>Что такое urq квест?</h3>
        <p><mark>urq-квест</mark> состоит из текстового файла с расширением ".qst", и, при необходимости, файлов
            ресурсов: таких как картинки, музыка. Для удобства все файлы лучше запаковать в <mark>zip</mark> архив.</p>
        <p>Если квест большой, то для удобства можно разделить <mark>qst</mark> файл на несколько файлов. Например был один
            <mark>big.qst</mark>, и мы решили разделить его на три файла: <mark>glava1.qst</mark>, <mark>glava2.qst</mark>,
            <mark>glava3.qst</mark>, это будет работать. Но какой файл загрузится первым? Это ведь важно, в таких вещах
            нельзя полагаться на случайность! Поставьте символ "_" перед названием файла чтобы гарантированно сделать
            его главным. В нашем примере это будет <mark>_glava1.qst</mark></p>
        <p>Для редактирования <mark>qst</mark> файлов используйте любой текстовый редактор на ваш вкус.</p>
    </div>

    <div id="системные конструкции">
        <h3>Системные конструкции:</h3>
        <p><mark>#[переменная]$</mark> - вывод переменной</p>
        <p><mark>#%[переменная]$</mark> - вывод переменной</p>
        <code>
            яблок = 4 <br>
            pln У меня <mark>#яблок$</mark> яблока! <br>
        </code>
        <p class="result">Результат:</p>
        <samp>У меня <mark>4</mark> яблока!</samp>
        <p><mark>##[код символа]$</mark> - вывод экранированного символа. Экранированный символ пригоден только для вывода на экран, он не
            может быть частью оператора. Например <mark>##59$</mark> это экранированный символ "<mark>;</mark>" в режиме dosurq и ripurq не будет считаться комментарием.
            Можно использовать <mark>##44$</mark> (экранированный символ "<mark>,</mark>") чтобы вывести строку с запятой в операторе <mark>btn</mark></p>

        <p><mark>#/$</mark> - заменяется на перенос строки</p>
        <p><mark>#%/$</mark> - заменяется на перенос строки</p>
        <p><mark>#$</mark> - заменяется на пробел</p>
        <p><mark>#%$</mark> - заменяется на пробел</p>
        <p><mark>&</mark> - склеивает операторы между собой (исполнение слева направо)</p>
        <code>a = 1 & goto castle</code>
    </div>


    <div id="системные переменные">
        <h3>Системные переменные</h3>
        <p><mark>urq_mode</mark> - флаг, указывающий на особенности в проигрывании данного квеста (подробности ниже) нужен
            для проигрывания старых квестов, написанных под другие интерпретаторы</p>
        <p><mark>count_[локация]</mark> - счётчик заходов на локацию, меняется от операторов <mark>btn</mark>, <mark>proc</mark>, <mark>goto</mark></p>
        <p><mark>music</mark> - если присвоить этой переменной файл с музыкой, то она начнёт проигрываться циклично (будет бесконечно повторяться по окончанию) (путь необходимо указывать относительно qst файла)</p>
        <code>music="music/fon.mp3"</code>
        <code>music="fon.mp3"</code>
        <p><mark>common</mark> - изменение этой переменной приведёт к тому, что оператор <mark>btn</mark> станет вызывать локацию не <mark>:common</mark>, а
            <mark>:common_{значение}</mark> при переходах</p>
        <p><mark>current_loc</mark> - название текущей локации. Меняется при btn и goto переходах</p>
        <p><mark>previous_loc</mark> - название предыдущей локации. Меняется при btn и goto переходах</p>
        <p><mark>style_dos_textcolor</mark> - число от 0 до 15. Меняет цвет текста на DOS-цвета. Вот они:</p>
        <code>
            <span style="color: #000000;">0</span>
            <span style="color: #0000AA;">1</span>
            <span style="color: #00AA00;">2</span>
            <span style="color: #00AAAA;">3</span>
            <span style="color: #AA0000;">4</span>
            <span style="color: #AA00AA;">5</span>
            <span style="color: #AA5500;">6</span>
            <span style="color: #AAAAAA;">7</span>
            <span style="color: #555555;">8</span>
            <span style="color: #5555FF;">9</span>
            <span style="color: #55FF55;">10</span>
            <span style="color: #55FFFF;">11</span>
            <span style="color: #FF5555;">12</span>
            <span style="color: #FF55FF;">13</span>
            <span style="color: #FFFF55;">14</span>
            <span style="color: #FFFFFF;">15</span>
        </code>
        <p><mark>style_textcolor</mark> - меняет текста на указанный (в шестнадцатеричном формате с префиксом #)</p>
        <p><mark>style_backcolor</mark> - меняет цвет фона (в шестнадцатеричном формате с префиксом #)</p>
        <code>style_backcolor = "#000" <span class="text-muted">/* цвет фона теперь черный */</span></code>
        <p><mark>image</mark> - выводит указанную картинку на экран (путь необходимо указывать относительно qst файла) в формате png, jpg, gif, и других</p>
        <code>image="images/battleship.jpg"</code>
        <code>image="battleship.jpg"</code>
        <p><mark>inv_[предмет]</mark> - возвращает количество [предмета] в инвентаре. Если присвоить этой переменной числовое значение,
            то количество предметов в инвентаре станет равным этому значению.</p>
        <code>
            <mark>inv_Яблоко</mark> = 4<br>
            if <mark>inv_Яблоко</mark> > 0 then pln у меня есть как минимум одно яблоко!
        </code>
        <p><mark>[предмет]</mark> - возвращает количество [предмета] в инвентаре</p>
        <code>
            inv+ 4, Яблоко<br>
            if <mark>яблоко</mark> then pln у меня есть как минимум одно яблоко!
        </code>
        <p><mark>rnd</mark> - при каждом обращении возвращает <mark>случайное</mark> число от 0 до 1, исключая 1</p>
        <p><mark>rnd[число]</mark> - при каждом обращении возвращает <mark>случайное</mark> число от 1 и до указанного числа</p>
        <code>
            a = rnd5<br>
            b = rnd15<br>
            pln число a - #a$.<br>
            pln число b - #b$.<br>
            pln Первое число от 1 до 5, второе от 1 до 15. Вероятно они разные. Хотя кто их знает.
        </code>
        <p class="result">Результат:</p>
        <samp>
            число a - 3.<br>
            число b - 14.<br>
            Первое число от 1 до 5, второе от 1 до 15. Вероятно они разные. Хотя кто их знает.
        </samp><p><mark>time</mark> - при каждом обращении возвращает число секунд прошедшие с полуночи</p>
        <code>
            pln #time$<br>
        </code>
        <p class="result">Результат:</p>
        <samp>
            36664
        </samp>
    </div>

    <div id="операторы">
        <h3>Операторы</h3>
        <p><mark>end</mark> -
            оператор окончания выполнения. Управление отдаётся игроку, он может нажать на кнопки, использовать инвентарь, и вообще.
            Обычно ставится в конце локации.</p>
        <p><mark>p {текст}</mark> или <mark>print {текст}</mark> -
            выводит указанный текст на экран. Можно использовать html. Строка не будет перенесена.</p>
        <code>
            p Рыцарь с &lt;b>мечом на поясе&lt;/b> громко рассмеялся. <br>
            p Похоже он был навеселе.
        </code>
        <p class="result">Результат:</p>
        <samp>Рыцарь с <b>мечом на поясе</b> громко рассмеялся. Похоже он был навеселе.</samp>
        <p><mark>pln {текст}</mark> или <mark>println {текст}</mark> -
            выводит указанный текст на экран и переносит строку. Можно использовать html.</p>
        <code>
            pln Рыцарь с &lt;b>мечом на поясе&lt;/b> громко рассмеялся. <br>
            pln Похоже он был навеселе.
        </code>
        <p class="result">Результат:</p>
        <samp>Рыцарь с <b>мечом на поясе</b> громко рассмеялся. <br>
            Похоже он был навеселе.</samp>

        <p><mark>[[ текст {| действия или локация }]]</mark> - эта конструкция вставит ссылку в оператор <mark>p</mark> или
            <mark>pln</mark>. При нажатии на ссылку. Может произойти переход на локацию или любое другой действие.
            Ссылками так же могут быть html элементы, например картинки.</p>
        <div class="example">
            <h4>Примеры:</h4>
            <code>
                pln Рыцарь с [[ мечом на поясе ]] громко рассмеялся.
            </code>
            <p class="result">Результатом будет ссылка, при нажатии на которую совершится переход на локацию <mark>мечом на поясе</mark>:</p>
            <samp>
                Рыцарь с <a>мечом на поясе</a> громко рассмеялся.
            </samp>
            <p class="result">Или так:</p>
            <code>
                pln Рыцарь с [[ мечом на поясе | осмотреть_меч ]] громко рассмеялся.
            </code>
            <p class="result">Результатом будет ссылка, при нажатии на которую совершится переход на локацию <mark>осмотреть_меч</mark>:</p>
            <samp>
                Рыцарь с <a>мечом на поясе</a> громко рассмеялся.
            </samp>
            <p class="result">Или так:</p>
            <code>
                pln Рыцарь с [[ мечом на поясе | внимательность = внимательность + 1 & goto осмотреть_меч ]] громко рассмеялся.
            </code>
            <p class="result">Результатом будет ссылка, при нажатии на которую <mark>внимательность</mark> увеличится на единицу,
                и совершится переход на локацию <mark>осмотреть_меч</mark>:</p>
            <samp>
                Рыцарь с <a>мечом на поясе</a> громко рассмеялся.
            </samp>
        </div>
        <p><mark>btn [метка], {текст перехода}</mark> -
            нарисует кнопку с указанным текстом. При нажатии игроком на неё, совершится переход на указанную метку (подробнее ниже)</p>
        <code>btn castle, Идти к замку <span class="text-muted">/* При нажатии на эту кнопку совершится переход на метку <mark>castle</mark> */</span></code>
        <p><mark>btn [оператор {& оператор...}], {текст перехода}</mark>
            нарисует кнопку с указанным текстом. При нажатии игроком на неё, выполнятся указанные операторы (подробнее ниже)</p>
        <code>btn денег = 14 &  goto castle, Идти к замку <span class="text-muted">/* При нажатии на эту кнопку переменная
        <mark>денег</mark> станет равно <mark>14</mark> и совершится переход на метку <mark>castle</mark> */</span></code>
        <p><mark>:[метка]</mark> - метка, на которую можно перейти с помощью операторов <mark>goto</mark>, <mark>proc</mark>,
            <mark>btn</mark>. Обычно метка это локация. Для примера создадим локацию рынок. Если это первая локация в игре,
            то квест начинается сразу с неё.</p>
        <code>
            :рынок <span class="text-muted">/* обозначение локации */</span><br>
            pln Вы находитесь на шумном рынке. <span class="text-muted">/* выводим игроку текст */</span><br>
            btn vendor, Подойти к торговцу <span class="text-muted">/* добавляем на локацию кнопку с действием */</span><br>
            end  <span class="text-muted">/* отдаём управление игроку */</span>
        </code>
        <p><mark>if</mark> [условие] <mark>then</mark> [тогда]{&тогда...} {<mark>else</mark> [иначе]{&иначе...}} - оператор условия</p>
        <code>
            <mark>if</mark> Яблок >= 4 <mark>then</mark> pln У меня достаточно яблок <mark>else</mark> pln У не хватает яблок, возьму-ка я ещё одно! & inv+ Яблоко <br>
            <span class="text-muted">/* <mark>Если яблок у игрока 4 или больше</mark> то выведет "У меня достаточно яблок", <mark>иначе</mark> выведет "У не хватает яблок, возьму-ка я ещё одно!" и добавит яблоко */</span>
        </code>
        <p><mark>goto [метка]</mark> -
            переход на указанную метку (увеличит счётчик заходов на локацию, переменная count_[метка])</p>
        <code>
            pln телепортируемся! <br>
            goto castle <span class="text-muted">/* При встрече этой строчки интерпретатор немедленно совершит переход на метку <mark>castle</mark> */</span>
        </code>
        <p><mark>cls</mark> - принудительно очищает экран от текста и кнопок</p>
        <p><mark>clsb</mark> - принудительно очищает от кнопок и текст от ссылок (превращает в текст)</p>
        <p><mark>music [файл]</mark> - проигрывает указанный файл один раз, останавливает предыдущий играющий файл вызванный через <mark>music</mark></p>
        <code>
            music "2.mp3"
        </code>
        <p><mark>play [файл]</mark> - проигрывает указанный файл один раз</p>
        <code>
            play "Slash.wav"
        </code>
        <p><mark>image [файл]</mark> - выводит указанное изображение</p>
        <p><mark>proc [метка]</mark> -
            переход на указанную локацию и выполнение квеста до оператора <mark>end</mark>, после чего возврат на изначальную позицию (на позицию следующую после вызова proc [метка])
            (увеличит счётчик заходов на локацию, переменная <mark>count_[метка]</mark>)</p>
        <p><mark>forget_procs</mark> -
            "забыть" о переходе через <mark>proc</mark>, возврата при встрече <mark>end</mark> не будет</p>
        <p><mark>anykey {переменная}</mark> -
            просит игрока нажать на любую клавишу или щёлкнуть мышкой. После этого выполнение квеста продолжится
            если указана "переменная", то код нажатой клавиши запишется в эту переменную</p>
        <code>
            pln Нажмите любую кнопку чтобы принять лицензионное соглашение.<br>
            anykey x <span class="text-muted">/* выполнение прерывается, просим нажать на клавишу. Переменная <mark>x</mark>
            станет равна коду нажатой клавиши */</span>
        </code>
        <p><mark>pause [время в миллисекундах]</mark>
            оператор прерывает выполнение квеста на указанное количество миллисекунд<br>
            Важно: в это время игра не заблокирована, игрок может использовать инвентарь и нажимать на <mark>btn</mark>-кнопки (если есть)
            Если игрок что-то сделал, то пауза прерывается.</p>
        <code>
            pln - Теперь подождём пока зелье сварится - сказал волшебник.<br>
            pln Мы сели и начали ждать.<br>
            <mark>pause 5000</mark> <span class="text-muted">/* Пауза в <mark>пять</mark> секунд */</span><br>
            pln - Готово! Забирай.<br>
            inv+ Зелье
        </code>
        <p><mark>input [переменная]</mark> -
            оператор заставляет игрока ввести что-нибудь с клавиатуры. Введённая строка попадает в переданную переменную </p>
        <code>
            pln Введите пароль, я не подглядываю<br>
            <mark>input text_perem</mark> <br>
            pln Ага! Ваш пароль <mark>#text_perem$</mark>
        </code>
        <p><mark>quit</mark> -
            конец квеста. Больше делать ничего нельзя. Никак.</p>
        <code>
            pln К сожалению, вас съел дракон, вы проиграли.<br>
            <mark>quit</mark>
        </code>
        <p><mark>perkill</mark> -
            Обнуляет переменные, в том числе и системные (кроме urq_mode). Не используйте без крайней необходимости.</p>
        <code>
            pln Начинается вторая часть игры. Она совсем никак не связана с первой!<br>
            <mark>perkill</mark> <span class="text-muted">/* Очистить все переменные, они больше не нужны */</span>
        </code>
        <p><mark>save</mark> - Сохраняет игру для пользователя в быстрый слот сохранения.</p>
    </div>

    <div id="предметы">
        <h3>Предметы</h3>
        <p><mark>inv+ {Количество,} Предмет</mark> -
            добавляет в инвентарь игроку указанное количество предметов (или один)</p>
        <code>
            pln - Держи килограмм отличных яблок - сказал торговец.<br>
            inv+ 10, Яблоко <span class="text-muted">/* в инвентарь добавилось <mark>10</mark> штук предмета <mark>Яблоко</mark> */</span>
        </code>
        <p><mark>inv- {Количество,} Предмет</mark> -
            Отнимает у игрока указанное количество предметов (или один)</p>
        <code>
            pln - Телепорт стоит 5 яблок! - сказал волшебник. Делать нечего, с половиной яблок придётся расстаться.<br>
            inv- 5, Яблоко <span class="text-muted">/* из инвентаря пропало <mark>5</mark> штук предмета <mark>Яблоко</mark> */</span>
        </code>
        <p><mark>invkill {Предмет}</mark> -
            Если предмет указан, то обнуляет количество этого предмета у игрока (станет 0). Если предмет не указан, то
            обнуляет инвентарь игрока (все предметы исчезнут)</p>
        <code>
            pln Вы проиграли все свои вещи в покер.<br>
            invkill
        </code>
    </div>

    <div id="комментарии">
        <h3>Комментарии</h3>
        <code>
    <span class="text-muted">/*<br>
       это комментарий<br>
    */</span>
        </code>
    </div>

    <div id="математические и логические операторы">

        <h3>Математические и логические операторы в порядке убывания приоритета</h3>

        <p><mark>(</mark> - </p>
        <p><mark>)</mark> - </p>
        <p><mark>not</mark> - "не"</p>
        <code>
            if not Лук then pln У вас нет лука!
        </code>
        <p><mark>*</mark> - умножение</p>
        <p><mark>/</mark> - деление</p>
        <p><mark>+</mark> - сложение</p>
        <p><mark>-</mark> - вычитание</p>
        <p><mark><</mark> - меньше</p>
        <p><mark><=</mark> - меньше или равно</p>
        <p><mark>></mark> - больше</p>
        <p><mark>>=</mark> - больше или равно</p>
        <p><mark>=</mark> - равно</p>
        <p><mark>==</mark> - сравнение строк по маске, <mark>*</mark> заменяется 0 и более любых символов,
            <mark>?</mark> заменяется на один любой символ</p>
        <code>
            pln Что вы хотите спросить у торговца?<br>
            input question<br>
            if question == "*алмаз*" then pln - Какие алмазы? - неожиданно рассердился торговец. - Я торгую фруктами!
        </code>
        <p><mark>!=</mark> - не равно</p>
        <p><mark><></mark> - не равно</p>
        <p><mark>&&</mark> - и</p>
        <p><mark>and</mark> - и</p>
        <p><mark>||</mark> - или</p>
        <p><mark>or</mark> - или</p>

    </div>

    <div id="примеры">
        <h3>Примеры</h3>

        <p><mark>btn</mark></p>
        <code>btn location, текст перехода <span class="text-muted">/* кнопка перехода на метку location */</span></code>

        <p>Произойдёт следующее (если метка существует):</p>
        <ol>
            <li>очистится экран и все кнопки</li>
            <li>вызовется метка <mark>:common</mark> или <mark>:common_[значение переменной common]</mark></li>
            <li>изменятся системные переменные <mark>previous_loc</mark> и <mark>current_loc</mark></li>
            <li>переменная <mark>count_location</mark> увеличится на 1</li>
            <li>совершится переход на локацию <mark>location</mark></li>
        </ol>


        <p><mark>xbtn</mark></p>
        <p>Это особенная кнопка с одним или несколькими действиями связанными через <mark>&</mark>, выполнение которых не обязательно должно приводить к переходу на другие локации. Исторически сохранилось название xbtn, но оператор используется тот же, - btn. Немного меняется синтаксис.</p>
        <code>btn a=a+1 & goto location, текст перехода <span class="text-muted">/* кнопка инкремент переменной "a" и переход на location */</span><br>
            btn goto location, текст перехода <span class="text-muted">/* переход на метку location без очистки экрана и прочего */</span></code>
    </div>

    <div id="режимы urq_mode">
        <h3>Режимы urq_mode</h3>
        <h5><mark>urq_mode="ripurq"</mark></h5>
        <p><mark>;</mark> - однострочный комментарий</p>
        <p>системные переменные вида <mark>count_метка</mark> теперь выглядят как просто "метка", т.е. count_ опускается</p>
        <p>очищаются кнопки при переходе <mark>goto</mark></p>
        <p>нет системной переменной <mark>common</mark></p>
        <h5><mark>urq_mode="dosurq"</mark></h5>
        <p>меняет цвет фона на черный</p>
        <p><mark>;</mark> - однострочный комментарий</p>
    </div>

    <div id="плагины">
        <h3>Плагины</h3>
        <p>Плагины расширяют возможности движка или меняют его внешний вид. Примеры плагинов можно найти в папке docs/plugins в репозитории. UrqW в качества плагинов подгружает два файла:</p>
        <h5><mark>Файл script.js</mark></h5>
        <p>Содержит код на языке javascript</p>
        <h5><mark>Файл style.css</mark></h5>
        <p>Описание стилей на языке css</p>
    </div>

</div>
</body>
</html>
